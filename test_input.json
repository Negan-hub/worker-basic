import requests
import uuid
import json
from PIL import Image
from io import BytesIO

# Replace with your RunPod.io endpoint URL (confirm with API documentation)
url = "https://api.runpod.io/v1/generate"  # Example endpoint, verify with RunPod documentation

# Set up your headers (replace with your actual API key)
headers = {
    "Authorization": "Bearer your-api-key",  # Replace with your actual API key
    "Content-Type": "application/json"
}

# Generate a unique request ID for this API call
request_id = str(uuid.uuid4())  # Generate a unique request ID

# Set up the request payload with the correct fields
payload = {
    "requestId": request_id,  # Include the unique request ID
    "input": {  # Include the 'input' field with the necessary details
        "prompt": "A cyberpunk cat riding a motorcycle in Tokyo at night",
        "num_images": 1,
        "size": "512x512"
    }
}

# Make the API call to generate the image
response = requests.post(url, headers=headers, json=payload)

# Check if the request was successful
if response.status_code == 200:
    # Print the entire response to check what fields are available
    response_data = response.json()
    print(json.dumps(response_data, indent=2))  # This will help to debug and confirm structure

    # Assuming the response contains the image URL or base64 image data
    if 'image_url' in response_data:
        image_url = response_data['image_url']  # Extract image URL from the response

        # Download and display the image if the URL is present
        image_response = requests.get(image_url)
        image = Image.open(BytesIO(image_response.content))
        image.show()
    elif 'base64_image' in response_data:
        # If the image is returned as base64
        base64_image_data = response_data['base64_image']
        image_data = BytesIO(base64.b64decode(base64_image_data))
        image = Image.open(image_data)
        image.show()
    else:
        print("No image URL or base64 image data in the response.")
else:
    print(f"Error: {response.status_code} - {response.text}")
